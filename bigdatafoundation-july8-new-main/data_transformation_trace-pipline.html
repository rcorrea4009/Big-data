<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Transformation Trace</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            line-height: 1.6;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        .stage {
            background: rgba(255,255,255,0.15);
            margin: 25px 0;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #4CAF50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .stage h3 {
            color: #4CAF50;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .code-block {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .data-row {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 15px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .data-label {
            font-weight: bold;
            color: #FFD700;
        }
        .data-value {
            font-family: monospace;
            background: rgba(0,0,0,0.2);
            padding: 5px 10px;
            border-radius: 5px;
        }
        .arrow {
            text-align: center;
            font-size: 28px;
            color: #FFD700;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .highlight {
            background: rgba(255,193,7,0.4);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        .loop-indicator {
            background: rgba(156,39,176,0.3);
            border: 2px dashed #9C27B0;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .final-result {
            background: rgba(76,175,80,0.3);
            border: 2px solid #4CAF50;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Step-by-Step Data Transformation Trace</h1>
        <p>Let's follow <strong>ONE ROW</strong> of data through the entire preprocessing pipeline:</p>
        
        <div class="stage">
            <h3>üìä Original Data Row</h3>
            <div class="data-row">
                <div class="data-label">age:</div>
                <div class="data-value">25</div>
            </div>
            <div class="data-row">
                <div class="data-label">job:</div>
                <div class="data-value">"teacher"</div>
            </div>
            <div class="data-row">
                <div class="data-label">marital:</div>
                <div class="data-value">"single"</div>
            </div>
            <div class="data-row">
                <div class="data-label">education:</div>
                <div class="data-value">"secondary"</div>
            </div>
            <div class="data-row">
                <div class="data-label">balance:</div>
                <div class="data-value">1200</div>
            </div>
            <div class="data-row">
                <div class="data-label">deposit:</div>
                <div class="data-value">"yes"</div>
            </div>
        </div>

        <div class="arrow">‚¨áÔ∏è PIPELINE STARTS ‚¨áÔ∏è</div>

        <div class="loop-indicator">
            <h3>üîÑ Loop Processing Categorical Columns</h3>
            <p>The loop processes each categorical column with 2 stages: StringIndexer ‚Üí OneHotEncoder</p>
        </div>

        <div class="stage">
            <h3>üî¢ Stage 1-2: Process "job" Column</h3>
            <div class="code-block">
categoricalCol = "job"
stringIndexer = StringIndexer(inputCol="job", outputCol="jobIndex")
encoder = OneHotEncoder(inputCols=["jobIndex"], outputCols=["jobclassVec"])
            </div>
            
            <div class="data-row">
                <div class="data-label">job:</div>
                <div class="data-value">"teacher" ‚Üí jobIndex: 0 ‚Üí jobclassVec: [1, 0, 0]</div>
            </div>
            <p><em>Assuming "teacher" is the most frequent job, it gets index 0</em></p>
        </div>

        <div class="stage">
            <h3>üî¢ Stage 3-4: Process "marital" Column</h3>
            <div class="code-block">
categoricalCol = "marital"  
stringIndexer = StringIndexer(inputCol="marital", outputCol="maritalIndex")
encoder = OneHotEncoder(inputCols=["maritalIndex"], outputCols=["maritalclassVec"])
            </div>
            
            <div class="data-row">
                <div class="data-label">marital:</div>
                <div class="data-value">"single" ‚Üí maritalIndex: 0 ‚Üí maritalclassVec: [1, 0, 0]</div>
            </div>
        </div>

        <div class="stage">
            <h3>üî¢ Stage 5-6: Process "education" Column</h3>
            <div class="code-block">
categoricalCol = "education"
stringIndexer = StringIndexer(inputCol="education", outputCol="educationIndex") 
encoder = OneHotEncoder(inputCols=["educationIndex"], outputCols=["educationclassVec"])
            </div>
            
            <div class="data-row">
                <div class="data-label">education:</div>
                <div class="data-value">"secondary" ‚Üí educationIndex: 1 ‚Üí educationclassVec: [0, 1, 0]</div>
            </div>
        </div>

        <div class="loop-indicator">
            <p><strong>üîÑ Loop continues for remaining columns:</strong> default, housing, loan, contact, poutcome</p>
            <p><em>Each gets StringIndexer + OneHotEncoder treatment...</em></p>
        </div>

        <div class="arrow">‚¨áÔ∏è</div>

        <div class="stage">
            <h3>üéØ Stage 17: Process Target Variable</h3>
            <div class="code-block">
label_stringIdx = StringIndexer(inputCol="deposit", outputCol="label")
            </div>
            
            <div class="data-row">
                <div class="data-label">deposit:</div>
                <div class="data-value">"yes" ‚Üí label: 1</div>
            </div>
            <p><em>Note: No OneHotEncoder for target variable!</em></p>
        </div>

        <div class="arrow">‚¨áÔ∏è</div>

        <div class="stage">
            <h3>üîß Stage 18: Vector Assembly</h3>
            <div class="code-block">
assemblerInputs = ["jobclassVec", "maritalclassVec", "educationclassVec", 
                   "defaultclassVec", "housingclassVec", "loanclassVec", 
                   "contactclassVec", "poutcomeclassVec",
                   "age", "balance", "duration", "campaign", "pdays", "previous"]

assembler = VectorAssembler(inputCols=assemblerInputs, outputCol="features")
            </div>
            
            <h4>üß© Combining All Features:</h4>
            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; font-family: monospace;">
                <div style="color: #4CAF50;">Categorical Features (One-Hot Encoded):</div>
                jobclassVec:      [1, 0, 0]<br>
                maritalclassVec:  [1, 0, 0]<br>
                educationclassVec: [0, 1, 0]<br>
                defaultclassVec:  [1, 0]      <em># assuming "no" default</em><br>
                housingclassVec:  [0, 1]      <em># assuming has housing loan</em><br>
                loanclassVec:     [1, 0]      <em># assuming no personal loan</em><br>
                contactclassVec:  [1, 0, 0]   <em># assuming "cellular"</em><br>
                poutcomeclassVec: [0, 0, 1]   <em># assuming "unknown"</em><br>
                <br>
                <div style="color: #FF9800;">Numeric Features:</div>
                age: 25<br>
                balance: 1200<br>
                duration: 180      <em># call duration</em><br>
                campaign: 2        <em># number of contacts</em><br>
                pdays: -1          <em># days since last contact</em><br>
                previous: 0        <em># previous contacts</em>
            </div>
        </div>

        <div class="arrow">‚¨áÔ∏è</div>

        <div class="final-result">
            <h3>üéâ Final Transformed Row</h3>
            <div style="font-family: monospace; font-size: 14px; word-break: break-all;">
                <div class="data-row">
                    <div class="data-label">features:</div>
                    <div class="data-value">[1,0,0, 1,0,0, 0,1,0, 1,0, 0,1, 1,0, 1,0,0, 0,0,1, 25, 1200, 180, 2, -1, 0]</div>
                </div>
                <div class="data-row">
                    <div class="data-label">label:</div>
                    <div class="data-value">1</div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                <h4>‚úÖ Ready for Machine Learning!</h4>
                <p>Our original row with mixed text and numbers has been transformed into pure numerical vectors that ML algorithms can process.</p>
            </div>
        </div>

        <div class="stage">
            <h3>üîç Understanding the Code Logic</h3>
            
            <h4>1. The Loop Magic:</h4>
            <div class="code-block">
for categoricalCol in categoricalColumns:
    # Creates 2 stages per column automatically
    stringIndexer = StringIndexer(inputCol=categoricalCol, outputCol=categoricalCol + 'Index')
    encoder = OneHotEncoder(inputCols=[stringIndexer.getOutputCol()], outputCols=[categoricalCol + "classVec"])
    stages += [stringIndexer, encoder]
            </div>
            
            <h4>2. The List Comprehension:</h4>
            <div class="code-block">
# This creates the input list for VectorAssembler
assemblerInputs = [c + "classVec" for c in categoricalColumns] + numericCols

# Expands to:
# ["jobclassVec", "maritalclassVec", "educationclassVec", ...] + ["age", "balance", ...]
            </div>
            
            <h4>3. Why This Approach Works:</h4>
            <ul>
                <li><span class="highlight">Automation</span>: One loop handles all categorical columns</li>
                <li><span class="highlight">Consistency</span>: Same transformation applied to all</li>
                <li><span class="highlight">Scalability</span>: Easy to add/remove columns</li>
                <li><span class="highlight">No Errors</span>: Programmatic naming prevents typos</li>
            </ul>
        </div>
    </div>
</body>
</html>